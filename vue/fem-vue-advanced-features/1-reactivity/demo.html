<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>vue reactive demo</title>
  </head>
  <body>
    <input type="text" />
    <br />
    <span></span>
    <script>
      class Dep {
        constructor() {
          this.subscriber = new Set()
        }
        register() {
          if (activeUpdate) {
            this.subscriber.add(activeUpdate)
          }
        }
        notify() {
          this.subscriber.forEach(sub => sub())
        }
      }

      let activeUpdate
      function autorun(update) {
        function wrappedUpdate() {
          activeUpdate = wrappedUpdate
          update()
          activeUpdate = null
        }
        wrappedUpdate()
      }

      function observe(obj) {
        Object.keys(obj).forEach(key => {
          var dep = new Dep()
          var internalValue = obj[key]
          Object.defineProperty(obj, key, {
            set(newValue) {
              internalValue = newValue
              dep.notify()
            },
            get() {
              dep.register()
              return internalValue
            }
          })
        })
      }

      var state = {
        value: 0
      }

      observe(state)

      function render() {
        document.querySelector('span').textContent = state.value
        document
          .querySelector('input')
          .addEventListener('input', e => (state.value = e.target.value))
      }

      autorun(render)
    </script>
  </body>
</html>
