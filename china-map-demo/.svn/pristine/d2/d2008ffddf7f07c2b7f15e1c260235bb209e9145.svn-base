<template>
  <div class="canvas-box" ref="canvasBox">
    <canvas ref="canvas">当前浏览器无法使用canvas，请更新浏览器版本</canvas>
  </div>
</template>

<script setup>
import { useAssetStore } from "@/stores/asset";
import { onBeforeUnmount, onMounted, ref } from "vue";
import { onBeforeRouteUpdate, useRoute } from "vue-router";
import topoData from "../utils/json/zhixin.json";

const ip_list = [
  { ip: "172.31.253.1", is_online: true },
  { ip: "192.168.200.1", is_online: true },
  { ip: "192.168.20.51", is_online: true },
  { ip: "192.168.200.240", is_online: true },
  { ip: "10.14.26.188", is_online: false },
  { ip: "10.14.69.58", is_online: false },
  { ip: "10.255.250.203", is_online: false },
  { ip: "10.14.14.189", is_online: false },
  { ip: "10.14.69.177", is_online: false },
  { ip: "10.65.60.48", is_online: false },
  { ip: "10.65.60.189", is_online: false },
  { ip: "1.1.1.1", is_online: false },
  { ip: "10.65.60.199", is_online: false },
  { ip: "10.65.60.45", is_online: false },
  { ip: "10.65.60.46", is_online: false },
  { ip: "10.65.60.47", is_online: false },
  { ip: "10.65.60.49", is_online: false },
  { ip: "10.65.60.50", is_online: false },
  { ip: "10.65.60.55", is_online: false },
  { ip: "10.65.60.54", is_online: false },
  { ip: "10.65.60.60", is_online: false },
  { ip: "10.65.60.64", is_online: false },
  { ip: "10.65.60.90", is_online: false },
  { ip: "10.65.60.80", is_online: false },
  { ip: "10.0.0.3", is_online: false },
  { ip: "10.1.15.10", is_online: false },
  { ip: "1.1.1.2", is_online: false },
  { ip: "1.1.1.12", is_online: false },
  { ip: "1.1.1.13", is_online: false },
  { ip: "1.1.1.10", is_online: false },
  { ip: "1.1.1.11", is_online: false },
  { ip: "1.1.1.4", is_online: false },
  { ip: "1.1.1.5", is_online: false },
  { ip: "1.1.1.6", is_online: false },
  { ip: "1.1.1.7", is_online: false },
  { ip: "1.1.1.3", is_online: false },
  { ip: "1.1.1.8", is_online: false },
  { ip: "1.1.1.9", is_online: false },
  { ip: "1.1.1.15", is_online: false },
  { ip: "1.1.1.18", is_online: false },
  { ip: "1.1.1.19", is_online: false },
  { ip: "1.1.1.16", is_online: false },
  { ip: "10.65.60.73", is_online: false },
  { ip: "10.0.0.9", is_online: false },
  { ip: "1.1.1.17", is_online: false },
  { ip: "1.1.1.14", is_online: false },
  { ip: "1.1.1.20", is_online: false },
  { ip: "1.1.1.25", is_online: false },
  { ip: "1.1.1.24", is_online: false },
  { ip: "1.1.1.23", is_online: false },
  { ip: "1.1.1.22", is_online: false },
  { ip: "1.1.1.21", is_online: false },
  { ip: "1.1.2.3", is_online: false },
  { ip: "1.1.2.2", is_online: false },
  { ip: "1.1.2.1", is_online: false },
  { ip: "1.1.2.7", is_online: false },
  { ip: "1.1.2.6", is_online: false },
  { ip: "1.1.2.5", is_online: false },
  { ip: "1.1.2.4", is_online: false },
  { ip: "1.1.2.9", is_online: false },
  { ip: "1.1.2.8", is_online: false },
  { ip: "1.1.2.10", is_online: false },
  { ip: "2.2.2.2", is_online: false },
  { ip: "2.2.2.13", is_online: false },
  { ip: "2.2.2.12", is_online: false },
  { ip: "2.2.2.11", is_online: false },
  { ip: "2.2.2.10", is_online: false },
  { ip: "2.2.2.9", is_online: false },
  { ip: "2.2.2.8", is_online: false },
  { ip: "2.2.2.7", is_online: false },
  { ip: "2.2.2.6", is_online: false },
  { ip: "2.2.2.5", is_online: false },
  { ip: "2.2.2.4", is_online: false },
  { ip: "2.2.2.3", is_online: false },
  { ip: "3.3.3.10", is_online: false },
  { ip: "3.3.3.11", is_online: false },
  { ip: "3.3.3.12", is_online: false },
  { ip: "3.3.3.13", is_online: false },
  { ip: "3.3.3.6", is_online: false },
  { ip: "3.3.3.7", is_online: false },
  { ip: "3.3.3.4", is_online: false },
  { ip: "3.3.3.5", is_online: false },
  { ip: "3.3.3.3", is_online: false },
  { ip: "3.3.3.8", is_online: false },
  { ip: "3.3.3.9", is_online: false },
  { ip: "4.4.4.9", is_online: false },
  { ip: "4.4.4.8", is_online: false },
  { ip: "4.4.4.5", is_online: false },
  { ip: "4.4.4.4", is_online: false },
  { ip: "4.4.4.7", is_online: false },
  { ip: "4.4.4.6", is_online: false },
  { ip: "4.4.4.14", is_online: false },
  { ip: "4.4.4.11", is_online: false },
  { ip: "4.4.4.10", is_online: false },
  { ip: "4.4.4.13", is_online: false },
  { ip: "4.4.4.12", is_online: false },
  { ip: "5.5.5.5", is_online: false },
  { ip: "10.12.12.12", is_online: false },
  { ip: "192.168.200.241", is_online: true },
  { ip: "192.168.200.242", is_online: true },
  { ip: "192.168.200.243", is_online: true },
  { ip: "192.168.200.200", is_online: true },
  { ip: "192.168.20.2", is_online: true },
  { ip: "192.168.20.21", is_online: true },
  { ip: "192.168.20.22", is_online: true },
  { ip: "192.168.20.23", is_online: true },
  { ip: "192.168.20.24", is_online: true },
  { ip: "192.168.20.25", is_online: true },
  { ip: "192.168.20.6", is_online: true },
  { ip: "192.168.20.7", is_online: true },
  { ip: "192.168.20.78", is_online: true },
  { ip: "192.168.20.31", is_online: true },
  { ip: "192.168.20.79", is_online: true },
  { ip: "192.168.20.80", is_online: true },
  { ip: "172.30.253.1", is_online: false },
  { ip: "192.168.222.1", is_online: true },
  { ip: "192.168.222.228", is_online: true },
  { ip: "192.168.222.229", is_online: true },
  { ip: "192.168.222.2", is_online: true },
  { ip: "192.168.100.6", is_online: true },
  { ip: "192.168.100.5", is_online: true },
  { ip: "192.168.100.4", is_online: true },
  { ip: "192.168.103.93", is_online: true },
  { ip: "192.168.103.94", is_online: false },
  { ip: "192.168.160.205", is_online: false },
  { ip: "192.168.150.250", is_online: true },
  { ip: "192.168.100.254", is_online: true },
  { ip: "192.168.222.8", is_online: true },
  { ip: "192.168.222.224", is_online: false },
  { ip: "192.168.103.68", is_online: true },
  { ip: "192.168.103.47", is_online: true },
  { ip: "192.168.103.56", is_online: true },
  { ip: "192.168.103.52", is_online: true },
  { ip: "192.168.103.72", is_online: true },
  { ip: "192.168.103.32", is_online: true },
  { ip: "192.168.103.16", is_online: true },
  { ip: "192.168.103.7", is_online: true },
  { ip: "192.168.103.49", is_online: true },
  { ip: "192.168.103.53", is_online: true },
  { ip: "192.168.103.14", is_online: true },
  { ip: "192.168.103.45", is_online: true },
  { ip: "192.168.103.74", is_online: true },
  { ip: "192.168.103.18", is_online: true },
  { ip: "192.168.103.70", is_online: true },
  { ip: "192.168.103.5", is_online: true },
  { ip: "192.168.103.27", is_online: true },
  { ip: "192.168.103.17", is_online: true },
  { ip: "192.168.103.71", is_online: true },
  { ip: "192.168.103.4", is_online: true },
  { ip: "192.168.103.58", is_online: true },
  { ip: "192.168.103.15", is_online: true },
  { ip: "192.168.103.54", is_online: true },
  { ip: "192.168.103.31", is_online: true },
  { ip: "192.168.103.66", is_online: true },
  { ip: "192.168.103.67", is_online: true },
  { ip: "192.168.103.50", is_online: true },
  { ip: "192.168.103.28", is_online: true },
  { ip: "192.168.103.24", is_online: true },
  { ip: "192.168.103.55", is_online: true },
  { ip: "192.168.103.69", is_online: true },
  { ip: "192.168.103.6", is_online: true },
  { ip: "192.168.103.29", is_online: true },
  { ip: "192.168.103.48", is_online: true },
  { ip: "192.168.103.51", is_online: true },
  { ip: "192.168.103.23", is_online: true },
  { ip: "192.168.103.73", is_online: true },
  { ip: "192.168.103.57", is_online: true },
  { ip: "192.168.103.30", is_online: true },
  { ip: "192.168.103.8", is_online: true },
  { ip: "192.168.103.86", is_online: false },
  { ip: "192.168.103.61", is_online: true },
  { ip: "192.168.103.1", is_online: true },
  { ip: "192.168.103.21", is_online: true },
  { ip: "192.168.103.62", is_online: true },
  { ip: "192.168.103.22", is_online: true },
  { ip: "192.168.103.19", is_online: true },
  { ip: "192.168.103.42", is_online: true },
  { ip: "192.168.103.41", is_online: true },
  { ip: "192.168.222.221", is_online: true },
  { ip: "192.168.160.10", is_online: true },
  { ip: "192.168.160.20", is_online: true },
  { ip: "192.168.160.30", is_online: true },
  { ip: "192.168.160.40", is_online: true },
  { ip: "192.168.160.50", is_online: true },
  { ip: "192.168.160.60", is_online: true },
  { ip: "192.168.160.11", is_online: false },
  { ip: "192.168.160.12", is_online: false },
  { ip: "192.168.160.13", is_online: false },
  { ip: "192.168.160.14", is_online: true },
  { ip: "192.168.160.21", is_online: false },
  { ip: "192.168.160.22", is_online: false },
  { ip: "192.168.160.23", is_online: false },
  { ip: "192.168.160.24", is_online: true },
  { ip: "192.168.160.31", is_online: false },
  { ip: "192.168.160.32", is_online: false },
  { ip: "192.168.160.33", is_online: false },
  { ip: "192.168.160.34", is_online: true },
  { ip: "192.168.160.41", is_online: false },
  { ip: "192.168.160.42", is_online: false },
  { ip: "192.168.160.43", is_online: false },
  { ip: "192.168.160.44", is_online: true },
  { ip: "192.168.160.51", is_online: false },
  { ip: "192.168.160.52", is_online: false },
  { ip: "192.168.160.53", is_online: false },
  { ip: "192.168.160.54", is_online: true },
  { ip: "192.168.160.61", is_online: false },
  { ip: "192.168.160.62", is_online: false },
  { ip: "192.168.160.63", is_online: false },
  { ip: "192.168.160.64", is_online: true },
  { ip: "192.168.222.222", is_online: false },
  { ip: "192.168.6.10", is_online: false },
  { ip: "192.168.6.11", is_online: false },
  { ip: "192.168.6.20", is_online: false },
  { ip: "192.168.6.21", is_online: false },
  { ip: "192.168.6.30", is_online: false },
  { ip: "192.168.6.31", is_online: false },
  { ip: "192.168.6.40", is_online: false },
  { ip: "192.168.6.41", is_online: false },
  { ip: "192.168.222.6", is_online: true },
  { ip: "192.168.222.225", is_online: true },
  { ip: "192.168.0.200", is_online: true },
  { ip: "192.168.222.227", is_online: true },
  { ip: "192.168.102.141", is_online: true },
  { ip: "192.168.100.231", is_online: true },
  { ip: "192.168.100.34", is_online: true },
  { ip: "192.168.100.223", is_online: true },
  { ip: "192.168.100.91", is_online: true },
  { ip: "192.168.100.194", is_online: true },
  { ip: "192.168.100.224", is_online: true },
  { ip: "192.168.102.135", is_online: true },
  { ip: "192.168.102.116", is_online: true },
  { ip: "192.168.100.59", is_online: true },
  { ip: "192.168.100.173", is_online: true },
  { ip: "192.168.102.244", is_online: true },
  { ip: "192.168.102.247", is_online: true },
  { ip: "192.168.102.188", is_online: true },
  { ip: "192.168.100.92", is_online: true },
  { ip: "192.168.100.73", is_online: true },
  { ip: "192.168.102.157", is_online: true },
  { ip: "192.168.102.150", is_online: true },
  { ip: "192.168.102.211", is_online: true },
  { ip: "192.168.100.49", is_online: true },
  { ip: "192.168.100.249", is_online: true },
  { ip: "192.168.100.42", is_online: true },
  { ip: "192.168.102.240", is_online: true },
  { ip: "192.168.102.206", is_online: true },
  { ip: "192.168.101.243", is_online: true },
  { ip: "192.168.102.139", is_online: true },
  { ip: "192.168.102.105", is_online: true },
  { ip: "192.168.101.254", is_online: true },
  { ip: "192.168.101.209", is_online: true },
  { ip: "192.168.102.134", is_online: true },
  { ip: "192.168.102.199", is_online: true },
  { ip: "192.168.100.76", is_online: true },
  { ip: "192.168.101.205", is_online: true },
  { ip: "192.168.102.243", is_online: true },
  { ip: "192.168.101.206", is_online: true },
  { ip: "192.168.102.241", is_online: true },
  { ip: "192.168.100.202", is_online: true },
  { ip: "192.168.101.211", is_online: true },
  { ip: "192.168.100.3", is_online: false },
  { ip: "192.168.100.98", is_online: false },
  { ip: "192.168.100.105", is_online: true },
  { ip: "192.168.100.107", is_online: true },
  { ip: "192.168.100.109", is_online: true },
  { ip: "192.168.100.112", is_online: false },
  { ip: "192.168.100.117", is_online: true },
  { ip: "192.168.100.118", is_online: false },
  { ip: "192.168.100.121", is_online: false },
  { ip: "192.168.100.122", is_online: true },
  { ip: "192.168.100.123", is_online: false },
  { ip: "192.168.100.126", is_online: true },
  { ip: "192.168.100.127", is_online: true },
  { ip: "192.168.100.128", is_online: false },
  { ip: "192.168.100.130", is_online: true },
  { ip: "192.168.100.131", is_online: true },
  { ip: "192.168.100.132", is_online: false },
  { ip: "192.168.100.133", is_online: false },
  { ip: "192.168.100.134", is_online: false },
  { ip: "192.168.100.135", is_online: false },
  { ip: "192.168.100.138", is_online: true },
  { ip: "192.168.100.169", is_online: true },
  { ip: "192.168.103.201", is_online: false },
  { ip: "192.168.100.99", is_online: true },
  { ip: "192.168.100.243", is_online: true },
  { ip: "192.168.100.101", is_online: false },
  { ip: "192.168.100.102", is_online: true },
  { ip: "192.168.100.103", is_online: false },
  { ip: "192.168.100.104", is_online: false },
  { ip: "192.168.100.106", is_online: false },
  { ip: "192.168.100.108", is_online: false },
  { ip: "192.168.100.110", is_online: false },
  { ip: "192.168.100.111", is_online: true },
  { ip: "192.168.100.113", is_online: false },
  { ip: "192.168.100.114", is_online: true },
  { ip: "192.168.100.115", is_online: false },
  { ip: "192.168.100.116", is_online: false },
  { ip: "192.168.100.119", is_online: true },
  { ip: "192.168.100.120", is_online: false },
  { ip: "192.168.100.124", is_online: false },
  { ip: "192.168.100.125", is_online: false },
  { ip: "192.168.100.129", is_online: false },
  { ip: "192.168.103.211", is_online: false },
  { ip: "192.168.103.212", is_online: false },
  { ip: "192.168.103.213", is_online: false },
  { ip: "192.168.103.214", is_online: false },
  { ip: "192.168.103.215", is_online: false },
  { ip: "192.168.103.216", is_online: false },
  { ip: "192.168.103.217", is_online: false },
  { ip: "192.168.103.218", is_online: false },
  { ip: "192.168.103.219", is_online: false },
  { ip: "192.168.103.220", is_online: false },
  { ip: "192.168.103.221", is_online: false },
  { ip: "192.168.103.222", is_online: false },
  { ip: "192.168.103.223", is_online: false },
  { ip: "192.168.103.224", is_online: false },
  { ip: "192.168.103.225", is_online: false },
  { ip: "192.168.103.226", is_online: false },
  { ip: "192.168.103.227", is_online: false },
  { ip: "192.168.103.228", is_online: false },
  { ip: "192.168.103.229", is_online: false },
  { ip: "192.168.103.230", is_online: false },
  { ip: "192.168.150.3", is_online: true },
  { ip: "192.168.222.11", is_online: true },
  { ip: "192.168.222.9", is_online: true },
  { ip: "192.168.222.7", is_online: true },
  { ip: "192.168.222.10", is_online: true },
  { ip: "192.168.142.200", is_online: false },
  { ip: "192.168.142.190", is_online: false },
  { ip: "192.168.142.180", is_online: false },
  { ip: "192.168.142.170", is_online: false },
  { ip: "192.168.142.160", is_online: false },
  { ip: "192.168.142.150", is_online: false },
  { ip: "192.168.142.140", is_online: false },
  { ip: "192.168.142.130", is_online: false },
  { ip: "192.168.142.120", is_online: false },
  { ip: "192.168.142.110", is_online: false },
  { ip: "192.168.142.100", is_online: false },
  { ip: "192.168.142.90", is_online: false },
  { ip: "192.168.142.80", is_online: false },
  { ip: "192.168.142.70", is_online: false },
  { ip: "192.168.142.60", is_online: false },
  { ip: "192.168.142.50", is_online: false },
  { ip: "192.168.142.40", is_online: false },
  { ip: "192.168.142.30", is_online: false },
  { ip: "192.168.142.20", is_online: false },
  { ip: "192.168.142.10", is_online: false },
  { ip: "192.168.142.163", is_online: false },
  { ip: "192.168.142.162", is_online: false },
  { ip: "192.168.142.153", is_online: false },
  { ip: "192.168.142.152", is_online: false },
  { ip: "192.168.142.143", is_online: false },
  { ip: "192.168.142.142", is_online: false },
  { ip: "192.168.142.133", is_online: false },
  { ip: "192.168.142.132", is_online: false },
  { ip: "192.168.142.123", is_online: false },
  { ip: "192.168.142.122", is_online: false },
  { ip: "192.168.142.113", is_online: false },
  { ip: "192.168.142.112", is_online: false },
  { ip: "192.168.142.63", is_online: false },
  { ip: "192.168.142.62", is_online: false },
  { ip: "192.168.142.53", is_online: false },
  { ip: "192.168.142.52", is_online: false },
  { ip: "192.168.142.43", is_online: false },
  { ip: "192.168.142.42", is_online: false },
  { ip: "192.168.142.33", is_online: false },
  { ip: "192.168.142.32", is_online: false },
  { ip: "192.168.142.23", is_online: false },
  { ip: "192.168.142.22", is_online: false },
  { ip: "192.168.142.13", is_online: false },
  { ip: "192.168.142.12", is_online: false },
  { ip: "192.168.142.201", is_online: false },
  { ip: "192.168.142.191", is_online: false },
  { ip: "192.168.142.181", is_online: false },
  { ip: "192.168.142.171", is_online: false },
  { ip: "192.168.142.161", is_online: false },
  { ip: "192.168.142.151", is_online: false },
  { ip: "192.168.142.141", is_online: false },
  { ip: "192.168.142.131", is_online: false },
  { ip: "192.168.142.121", is_online: false },
  { ip: "192.168.142.111", is_online: false },
  { ip: "192.168.142.101", is_online: false },
  { ip: "192.168.142.91", is_online: false },
  { ip: "192.168.142.81", is_online: false },
  { ip: "192.168.142.71", is_online: false },
  { ip: "192.168.142.61", is_online: false },
  { ip: "192.168.142.51", is_online: false },
  { ip: "192.168.142.41", is_online: false },
  { ip: "192.168.142.31", is_online: false },
  { ip: "192.168.142.21", is_online: false },
  { ip: "192.168.142.11", is_online: false },
  { ip: "192.168.142.237", is_online: false },
  { ip: "192.168.142.236", is_online: false },
  { ip: "192.168.142.235", is_online: false },
  { ip: "192.168.142.234", is_online: false },
  { ip: "192.168.142.233", is_online: false },
  { ip: "192.168.142.232", is_online: false },
  { ip: "192.168.142.230", is_online: false },
  { ip: "192.168.141.131", is_online: false },
  { ip: "192.168.141.137", is_online: false },
  { ip: "192.168.141.138", is_online: false },
  { ip: "192.168.141.139", is_online: false },
  { ip: "192.168.141.140", is_online: false },
  { ip: "192.168.141.132", is_online: false },
  { ip: "192.168.141.133", is_online: false },
  { ip: "192.168.141.134", is_online: false },
  { ip: "192.168.141.135", is_online: false },
  { ip: "192.168.141.136", is_online: false },
  { ip: "192.168.141.180", is_online: false },
  { ip: "192.168.141.189", is_online: false },
  { ip: "192.168.141.190", is_online: false },
  { ip: "192.168.141.193", is_online: false },
  { ip: "192.168.141.194", is_online: false },
  { ip: "192.168.141.195", is_online: false },
  { ip: "192.168.141.196", is_online: false },
  { ip: "192.168.141.181", is_online: false },
  { ip: "192.168.141.182", is_online: false },
  { ip: "192.168.141.183", is_online: false },
  { ip: "192.168.141.184", is_online: false },
  { ip: "192.168.141.185", is_online: false },
  { ip: "192.168.141.186", is_online: false },
  { ip: "192.168.141.187", is_online: false },
  { ip: "192.168.141.188", is_online: false },
  { ip: "192.168.141.105", is_online: false },
  { ip: "192.168.141.170", is_online: false },
  { ip: "192.168.141.171", is_online: false },
  { ip: "192.168.141.174", is_online: false },
  { ip: "192.168.141.176", is_online: false },
  { ip: "192.168.141.178", is_online: false },
  { ip: "192.168.141.175", is_online: false },
  { ip: "192.168.141.177", is_online: false },
  { ip: "192.168.141.173", is_online: false },
  { ip: "192.168.141.147", is_online: false },
  { ip: "192.168.141.156", is_online: false },
  { ip: "192.168.141.157", is_online: false },
  { ip: "192.168.141.160", is_online: false },
  { ip: "192.168.141.161", is_online: false },
  { ip: "192.168.141.166", is_online: false },
  { ip: "192.168.141.163", is_online: false },
  { ip: "192.168.141.148", is_online: false },
  { ip: "192.168.141.149", is_online: false },
  { ip: "192.168.141.150", is_online: false },
  { ip: "192.168.141.151", is_online: false },
  { ip: "192.168.141.152", is_online: false },
  { ip: "192.168.141.153", is_online: false },
  { ip: "192.168.141.154", is_online: false },
  { ip: "192.168.141.155", is_online: false },
  { ip: "192.168.141.158", is_online: false },
  { ip: "192.168.141.106", is_online: false },
  { ip: "192.168.141.141", is_online: false },
  { ip: "192.168.141.144", is_online: false },
  { ip: "192.168.141.145", is_online: false },
  { ip: "192.168.141.146", is_online: false },
  { ip: "192.168.141.143", is_online: false },
  { ip: "192.168.102.249", is_online: true },
  { ip: "192.168.102.168", is_online: true },
  { ip: "192.168.100.41", is_online: true },
  { ip: "192.168.100.96", is_online: true },
  { ip: "192.168.102.137", is_online: true },
  { ip: "172.29.253.1", is_online: false },
  { ip: "192.168.20.11", is_online: true },
  { ip: "192.168.20.32", is_online: true },
  { ip: "192.168.13.55", is_online: true },
  { ip: "192.168.13.77", is_online: false },
  { ip: "192.168.200.2", is_online: true },
  { ip: "192.168.200.3", is_online: true },
  { ip: "172.31.253.2", is_online: true },
  { ip: "192.168.13.2", is_online: false },
  { ip: "192.168.13.100", is_online: true },
  { ip: "192.168.13.94", is_online: true },
];

const { params } = useRoute();

const canvas = ref(null);
const canvasBox = ref(null);

const { assetStatus } = useAssetStore();
console.log(assetStatus);

onMounted(async () => {
  // 初始化topo图数据
  // const response = await http.get(`/isoc/api/v1/asset_topo/get_asset_topo`, {
  //   topo_id: params.id,
  // });
  // const data = response?.errMsg?.data ?? [];
  const data = topoData.data;
  initCanvas(data);
});

onBeforeUnmount(() => {});

onBeforeRouteUpdate(async (to, from) => {
  if (to.params.id !== from.params.id) {
    // const response = await http.get(`/isoc/api/v1/asset_topo/get_asset_topo`, {
    //   topo_id: to.params.id,
    // });
    // const data = response?.errMsg?.data ?? [];
    let data;
    if (to.params.id == 1) {
      data = topoData1.data;
    }
    if (to.params.id == 2) {
      data = topoData2.data;
    }
    if (to.params.id == 3) {
      data = topoData3.data;
    }
    initCanvas(data);
  }
});

function initCanvas(data) {
  let stage;
  if (stage) {
    stage.clear();
  }

  canvas.value.width = canvasBox.value.offsetWidth;
  canvas.value.height = canvasBox.value.offsetHeight;

  const topoInstance = JTopo.deSeriailzeByJSON(data, canvas.value);
  stage = topoInstance.stage;
  stage.mode = "normal";
  stage.zoomIn(0.7);

  // const clickNode = async (event) => {
  //   if (event.target.eleData.eleType === "group") {
  //     const groupName = event.target.eleData.eleName;
  //     const response = await http.get(
  //       `/isoc/api/v1/asset_topo/get_asset_by_group`,
  //       { group_name: groupName }
  //     );
  //     // TODO: 下一层
  //     const data = response?.errMsg ?? [];
  //     console.log("group", data);
  //     // initCanvas(data);
  //   }
  // };

  const statusGreen = "51,204,153";
  const statusRed = "255,51,85";

  const scene = stage.childs[0];
  const allNodes = scene.getDisplayedNodes();
  allNodes.forEach((node) => {
    // console.log(node);
    const statusIcon = new JTopo.Node();
    statusIcon.setSize(20, 20);
    statusIcon.x = node.x - 20;
    statusIcon.y = node.y;
    statusIcon.borderRadius = 10;

    if (node.eleData?.assetIP) {
      const status = ip_list?.find((e) => `${e.ip},` == node.eleData.assetIP);
      // console.log(node.eleData.assetIP);
      if (!!status?.is_online) {
        statusIcon.fillColor = statusGreen;
      } else {
        statusIcon.fillColor = statusRed;
      }
    } else {
      statusIcon.fillColor = statusGreen;
    }

    scene.add(statusIcon);
  });
}
</script>

<style scoped>
.canvas-box {
  width: 80%;
  height: 100%;
  margin: 0 auto;
  /* padding-top: 10px; */
}
</style>
