<template>
  <div class="canvas-box" ref="canvasBox">
    <canvas ref="canvas">当前浏览器无法使用canvas，请更新浏览器版本</canvas>
  </div>
</template>

<script setup>
import { onBeforeUnmount, onMounted, ref } from "vue";
import { useRoute } from "vue-router";
import topoData from "../utils/json/tianjin.json";

const { params } = useRoute();

const canvas = ref(null);
const canvasBox = ref(null);

onMounted(async () => {
  // 初始化topo图数据
  // const response = await http.get(`/isoc/api/v1/asset_topo/get_asset_topo`, {
  //   topo_id: params.id,
  // });
  // const data = response?.errMsg?.data ?? [];
  const data = topoData.data;
  initCanvas(data);
});

onBeforeUnmount(() => {});

function initCanvas(data) {
  let stage;
  if (stage) {
    stage.clear();
  }

  canvas.value.width = canvasBox.value.offsetWidth;
  canvas.value.height = canvasBox.value.offsetHeight;

  const topoInstance = JTopo.deSeriailzeByJSON(data, canvas.value);
  stage = topoInstance.stage;
  stage.frames = -24; // 避免新建画布的屏幕闪
  stage.mode = "normal";
  stage.zoomIn(0.7);
}
</script>

<style scoped>
.canvas-box {
  width: 80%;
  height: 100%;
  margin: 0 auto;
  /* padding-top: 10px; */
}
</style>
